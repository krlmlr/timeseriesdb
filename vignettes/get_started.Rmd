---
title: "Getting Started"
subtitle: "Introduction to {timeseriesdb}"
author: "Matthias Bannert and Severin ThÃ¶ni"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

## Starting Point

This guide assumes you have installed the {timeseriesdb} R package and a local PostgreSQL client library successfully. We also assume that you have a PostgreSQL database running somewhere that you can connect to. 

For the remainder of this guide we assume PostgreSQL runs on a local docker container accessible on port 1111.


## Store Time Series 

Let's take two time series from the {datasets} R package that ships with R (monthly AirPassengers, JohnsonJohnson quarterly earnings per share) and put them in to a named list. The {timeseriesdb} R package uses lists of time series or long format time series data.tables to stage time series for storing in PostgreSQL. 

```{r}
devtools::load_all()
#library(timeseriesdb)

con <- dbConnect(RPostgres::Postgres(),
                 dbname = "postgres",
                 user = "dev_admin",
                 host = "localhost",
                 password = "",
                 port = 1111)
tsl <- list(AirPassengers = AirPassengers,
            JohnsonJohnson = JohnsonJohnson)
store_time_series(con, tsl, "main")

```
 
## Basic Read Time Series
 
```{r}
library(tstools)
out <- read_time_series(con, c("JohnsonJohnson",
                               "AirPassengers"))
tsplot(out[1],
       tsr = out[2])
```

## Versioning of Time Series (Vintages)

{timeseriesdb} keeps track of different versions of a time series. This feature was designed with regular releases of data in mind. In official and economic statistics, releases do not simply mean to append another observation at end of time series. Seasonal adjustment and other filters as well data corrections cause revisions of a time series. In order to keep research, e.g., forecasts reproducible, it is important to archive all versions of a time series. Doing so, allows to assess forecast performance and makes sure the state of information at the time the forecast was made can be reproduced.

{timeseriesdb} allows to store one version of a time series per day, i.e., series 


## Datasets

In {timeseriesdb} *every* time series belongs to a dataset. If no dataset is specified when a time series is stored, the series automagically gets assigned to the *default* dataset.

The idea behind datasets is to group time series according to their source and allow for group level data description. The
following helpers help you to explore which keys are in a given set and which keys are in which set.

```{r}
db_get_dataset_keys(con, set_name = "default")
db_get_dataset_id(con, c("AirPassengers", "JohnsonJohnson"))
```

You can easily add new datasets. Note though, that dataset are not user specific, but global groups. The user specific analog to sets is called collection in will be described later on. 

```{r}
db_create_dataset(con, "stocks",
                  set_description = "Stock market returns.")
```
Once a set is created you can move existing series to that set. 

```{r}
db_assign_dataset(con,"JohnsonJohnson","stocks")
db_get_dataset_id(con, c("AirPassengers", "JohnsonJohnson"))
```



## Metadata 

```{r}
db_read_ts_metadata(con, "AirPassengers")
```


## Collections (aka playlists)







