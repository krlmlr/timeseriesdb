---
title: "Developer Documentation"
author: "Matthias Bannert and Severin ThÃ¶ni"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Getting Started}
  %\VignetteEngine{knitr::rmarkdown}
  \usepackage[utf8]{inputenc}
---

## General Overview


![](timeseriesdb_1_0.png)

The *vintages* table is the main table that keeps all the different versions of a time series. The *catalog* table holds the stem of a time series identified by *ts_key*. These stems do not hold any observational values but provide links to *datasets* specific descriptions as well as time series specific meta information. This avoids redundancy and fosters searching keys by regular expressions in case the *vintages* table is hash partitioned. *Collections* allow users to create sets of time series identifiers (keys) in similar fashion as playlists in music apps. Tables with an *md_* prefix store meta information at different levels. By having multiple tables the user can choose whether meta information needs to be versioned, too. 

The following sections describe the actions behind standard write and read processes. Due to the fact that not only a time series itself is stored but versions of it as well as comprehensive data descriptions, multiple tables are affected. 


## Storing New Time Series

If an entirely new series is stored it belongs to the *default* dataset unless specified otherwise. Because a catalog entry for the stem does not exist yet, a new *ts_key* is inserted into the catalog. 

Once a *ts_key* is created a first version is inserted into the *timeseries_main* table. The first version is valid from the current ```Sys.Date()``` until an open end. 

## Adding a New Vintage (Version) to an Existing Time Series

In case a *ts_key* already exists in the time series catalog it is **NOT** updated. This is major change compared to previous versions of {timeseriesdb} in which versions were not kept by default. With {timeseriesdb} > 1.0 the stem will not be modified. Instead a new version of the time series will be added to the *timeseries_main* table. 


## Access Management

{timeseriesdb}'s access management relies on the idea that users cannot 
directly issue SQL queries to the database. {timeseriesdb} uses SECURITY DEFINER
functions which are executed as the owner of the function. The owner of the function
is a privileged user that is allowed to do advanced stuff, but only within the scope
of the function. This way access to the time series data can be managed at a very
fine grained level. 














