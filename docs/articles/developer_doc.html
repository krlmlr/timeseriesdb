<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>timeseriesdb Developer Documentation • timeseriesdb</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="timeseriesdb Developer Documentation">
<meta property="og:description" content="timeseriesdb">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">timeseriesdb</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/developer_doc.html">timeseriesdb Developer Documentation</a>
    </li>
    <li>
      <a href="../articles/get_started.html">Getting Started</a>
    </li>
    <li>
      <a href="../articles/manage_timeseries_with_r_and_postgres.html">Manage Official Statistics' Time Series Data with R and PostgreSQL</a>
    </li>
    <li>
      <a href="../articles/metadata.html">Manage Official Statistics' Time Series Data with R and PostgreSQL</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mbannert/timeseriesdb/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>timeseriesdb Developer Documentation</h1>
                        <h4 class="author">Matthias Bannert and Severin Thöni</h4>
            
            <h4 class="date">2020-06-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mbannert/timeseriesdb/blob/master/vignettes/developer_doc.Rmd"><code>vignettes/developer_doc.Rmd</code></a></small>
      <div class="hidden name"><code>developer_doc.Rmd</code></div>

    </div>

    
    
<div id="general-overview" class="section level2">
<h2 class="hasAnchor">
<a href="#general-overview" class="anchor"></a>General Overview</h2>
<p><img src="timeseriesdb_1_0.png"></p>
<p>The <em>vintages</em> table is the main table that keeps all the different versions of a time series. The <em>catalog</em> table holds the stem of a time series identified by <em>ts_key</em>. These stems do not hold any observational values but provide a link to <em>datasets</em> time series specific descriptions as well as time series specific meta information as opposed to versioned meta data. This avoids redundancy and fosters searching keys by regular expressions in case the <em>vintages</em> table is hash partitioned. <em>Collections</em> allow users to sets of time series identifiers (keys), in similar fashion as playlists in music apps. Tables with an <em>md_</em> prefix store meta information different levels. But having multiple tables the user can choose whether meta information needs to be versioned, too.</p>
<p>The following sections describe the actions behind standard write and read processes. Due to the fact that not only a time series itself is stored but versions of it as well as comprehensive data descriptions, multiple tables are affected.</p>
</div>
<div id="storing-new-time-series" class="section level2">
<h2 class="hasAnchor">
<a href="#storing-new-time-series" class="anchor"></a>Storing New Time Series</h2>
<p>If an entirely new series is stored it belongs to the <em>default</em> dataset unless specified otherwise. Because a catalog entry for the stem does not exist yet, a new <em>ts_key</em> is inserted into the catalog.</p>
<p>Once a <em>ts_key</em> is created a first version is inserted into the <em>timeseries_main</em> table. The first version is valid from the current <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date()</a></code> until an open end.</p>
</div>
<div id="adding-a-new-vintage-version-to-an-existing-time-series" class="section level2">
<h2 class="hasAnchor">
<a href="#adding-a-new-vintage-version-to-an-existing-time-series" class="anchor"></a>Adding a New Vintage (Version) to an Existing Time Series</h2>
<p>In case a <em>ts_key</em> already exists in the time series catalog it is <strong>NOT</strong> updated. This is major change compared to previous versions of {timeseriesdb} as versions were not kept by default. With {timeseriesdb} &gt; 1.0 the stem will not be modified. Instead a new version of the time series will be added to the <em>timeseries_main</em> table.</p>
<p>In the process the validity of the previous versions of that time series will be closed (updated) at <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date()</a></code> unless another, future date is specified. The new version of the series is inserted into the <em>timeseries_main</em> table and its validity is set to start at <code><a href="https://rdrr.io/r/base/Sys.time.html">Sys.Date()</a></code> (or the specified future date) enforcing a non-overlapping constraint for time series versions (vintages).</p>
</div>
<div id="launch-a-docker-based-dev-environment" class="section level2">
<h2 class="hasAnchor">
<a href="#launch-a-docker-based-dev-environment" class="anchor"></a>Launch a Docker Based Dev Environment</h2>
<p>{timeseriesdb} ships with a routine to start up a development environment running PostgreSQL 11. Simply run the <em>start_dev_docker.sh</em> located in the /inst folder of the {timeseriesdb} package. Make sure the shell script is executable by your user (type <code>chmod +x start_dev_docker.sh</code> if it’s not).</p>
<pre><code>./start_dev_docker.sh</code></pre>
<p>Given you have a docker environment such as docker Desktop up an running, the above shell script will fire up a docker container running PostgreSQL 11 which contains a fully working {timeseriesdb} schema. Once your container is up and running you can reach out on port 1111 using R.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">RPostgres</span>)

<span class="no">con</span> <span class="kw">&lt;-</span> <span class="fu">dbConnect</span>(<span class="kw pkg">RPostgres</span><span class="kw ns">::</span><span class="fu"><a href="https://rpostgres.r-dbi.org/reference/Postgres.html">Postgres</a></span>(),
                 <span class="kw">dbname</span> <span class="kw">=</span> <span class="st">"postgres"</span>,
                 <span class="kw">user</span> <span class="kw">=</span> <span class="st">"dev_admin"</span>,
                 <span class="kw">host</span> <span class="kw">=</span> <span class="st">"localhost"</span>,
                 <span class="kw">password</span> <span class="kw">=</span> <span class="st">""</span>,
                 <span class="kw">port</span> <span class="kw">=</span> <span class="fl">1111</span>)</pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by 'Matthias Bannert'.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
